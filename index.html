<!DOCTYPE html>
<html>
<body style="background-color: #726f70">

<div style="width: 100%; padding: 0px; margin: 0px; text-align: center;margin-bottom: 10vh">
     <img src="logo.png" alt="logo" width="400" height="280"> 
</div>


<p id="result" style="width: 100%; margin-bottom: 10px; text-align: center;font-weight: bold;font-size: 36px;"></p>

<div style="width: 100%; padding: 0px; margin: 0px; display: flex;justify-content: center;">
    <button onclick="getLocation('Buraco')" style="background-color: #83fcd4; margin-right: 5vw">Buraco</button>
    <button onclick="getLocation('Desnivel')" style="background-color: #b5fc83">Desnível</button>
</div>

<div style="width: 100%; padding: 0px; margin: 0px; display: flex;justify-content: center;">
    <button onclick="getLocation('Objeto')" style="background-color: #fcd083; margin-right: 5vw">Objeto na pista</button>
    <button onclick="getLocation('Poca')" style="background-color: #c184fb">Poça D'água</button>
</div>

<p id="sendDataResult" style="width: 100%; margin-bottom: 10px; margin-top: 20vh;text-align: center;font-weight: bold;font-size: 36px;"></p>
<div style="width: 100%; padding: 0px; margin: 0px; display: flex;justify-content: center;">
    <button onclick="sendToServer()" style="background-color: #64969e;width: 60vw">Enviar dados</button>     
</div>


<style type="text/css">
    button {
        border-radius: 10px;
        height:10vh;
        width:40vw;
        font-weight: bold;
        font-size: 36px;
        margin-bottom: 5vh;    
    }
</style>

<script>
var x = document.getElementById("sendDataResult");
var y = document.getElementById("result");
var apontamentos = []

function getLocation(type) {
  x.innerHTML = ""
  if (navigator.geolocation) {
    if (type === 'Buraco') {
      if (confirm("Deseja apontar um buraco na pista?")) {
        navigator.geolocation.getCurrentPosition(sendBuracoPosition);
      }
    }
    if (type === 'Desnivel') {
      if (confirm("Deseja apontar um desnível na pista?")) {
        navigator.geolocation.getCurrentPosition(sendDesnivelPosition);
      }
    }
    if (type === 'Objeto') {
      if (confirm("Deseja apontar um objeto na pista?")) {
        navigator.geolocation.getCurrentPosition(sendObjetoPosition);
      }
    }
    if (type === 'Poca') {
      if (confirm("Deseja apontar uma poça d'água na pista?")) {
        navigator.geolocation.getCurrentPosition(sendPocaPosition);
      }
    }
  } else { 
    x.innerHTML = "Não é possível apontar com este navegador. Por favor, tente em outro.";
  }
}


function sendBuracoPosition(position) {

    apontamentos.push({
        type_ap: 'Buraco',
        lat: position.coords.latitude,
        lng: position.coords.longitude
    })
    y.innerHTML = "Ponto " + position.coords.latitude.toFixed(4) + "|" + position.coords.longitude.toFixed(4) + " adicionado"
}
function sendDesnivelPosition(position) {
    apontamentos.push({
        type_ap: 'Desnivel',
        lat: position.coords.latitude,
        lng: position.coords.longitude
    })
    y.innerHTML = "Ponto " + position.coords.latitude.toFixed(4) + "|" + position.coords.longitude.toFixed(4) + " adicionado"
}
function sendObjetoPosition(position) {
    apontamentos.push({
        type_ap: 'Objeto',
        lat: position.coords.latitude,
        lng: position.coords.longitude
    })
    y.innerHTML = "Ponto " + position.coords.latitude.toFixed(4) + "|" + position.coords.longitude.toFixed(4) + " adicionado"
}
function sendPocaPosition(position) {
    apontamentos.push({
        type_ap: 'Poca',
        lat: position.coords.latitude,
        lng: position.coords.longitude
    })
    y.innerHTML = "Ponto " + position.coords.latitude.toFixed(4) + "|" + position.coords.longitude.toFixed(4) + " adicionado"
}

function sendToServer() {
  
  let apontamentoToSend = {
    apnt: apontamentos
  }

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        y.innerHTML = ""
        x.innerHTML = "Apontado com sucesso"
        apontamentos = []
    }
  };
  xhttp.open("POST", "https://lots-iotag.herokuapp.com/write", true);
  xhttp.setRequestHeader("Content-type", "application/json");
  xhttp.send(JSON.stringify(apontamentoToSend));
}

</script>

</body>
</html>
